<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deteksi Penyakit Padi</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Font Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand text-white fw-bold" href="{{ url_for('landing_page') }}">RiceCare AI</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('landing_page') }}">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                    <li class="nav-item"><a class="nav-link active" href="{{ url_for('detect_page') }}">Disease Detection</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('diseases_page') }}">Rice Diseases</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Contact Us</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Section dengan Card -->
    <section>
        <div class="container">
            <!-- Wrapper untuk Card -->
            <div class="card-container">
                <!-- Card Input (Upload Gambar) -->
                <div class="col-12 col-lg-6 mb-3" id="cardInput">
                    <div class="card">
                        <div class="card-body">
                            <p>Unggah gambar daun padi untuk mendeteksi penyakit dan tingkat keparahannya.</p>
                            <div class="button-group">
                                <label class="btn">
                                    <input type="file" id="fileInput" hidden>
                                    Choose File
                                </label>
                                <button class="btn" id="takePhoto">Take a Photo</button>
                            </div>
                            <p id="fileName" class="namafile">No file chosen</p>

                            <!-- Input Varietas -->
                            <label class="header-input">Varietas tanaman</label>
                            <input type="text" id="varietas" class="input-box">
                            <div class="checkbox-group">
                                <input type="checkbox" id="skipVarietas">
                                <label for="skipVarietas">Kosongkan</label>
                            </div>

                            <!-- Input Umur -->
                            <label class="header-input">Umur tanaman</label>
                            <input type="text" id="umur" class="input-box">
                            <div class="checkbox-group">
                                <input type="checkbox" id="skipUmur">
                                <label for="skipUmur">Kosongkan</label>
                            </div>

                            <button class="submit-btn" id="submit">Submit</button>
                        </div>
                    </div>
                </div>
                <!-- Modal Kamera -->
                <div class="modal fade" id="cameraModal" tabindex="-1" aria-labelledby="cameraModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content chat-modal">
                    <div class="modal-header chat-header">
                        <h5 class="modal-title" id="cameraModalLabel">Ambil Foto dari Kamera</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                    </div>
                    <div class="modal-body text-center">
                        <video id="camera" autoplay playsinline style="width: 100%; max-width: 100%; border-radius: 10px;"></video>
                        <button class="btn mt-3" id="capturePhoto">Ambil Foto</button>
                        <canvas id="canvas" style="display: none;"></canvas>
                    </div>
                    </div>
                </div>
                </div>

            
                <!-- Card Output (Hasil Deteksi Penyakit) -->
                <div class="col-12 col-lg-6 mb-3" id="cardOutput">
                    <div class="card text-center p-3">
                        <h5 class="fw-bold">Hasil Deteksi Penyakit</h5>
                        <img id="previewImage" src="" alt="Preview Image" style="display:none; max-height: 200px; margin-top: 10px; border-radius: 8px; margin-bottom: 10px;" />
                        
                        <div id="loading" class="text-center">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p id="loadingText">Memproses gambar dan membuat respon AI...</p>
                        </div>

                        <div class="result-container">
                            <div class="result-item">
                                <span class="fw-bold">Nama Penyakit:</span>
                                <span id="namaPenyakit">-</span>
                            </div>
                            <div class="result-item">
                                <span class="fw-bold">Tingkat Keparahan:</span>
                                <span id="tingkatKeparahan">-</span>
                            </div>
                            <div class="result-item">
                                <span class="fw-bold">Akurasi Prediksi:</span>
                                <span id="presentasePrediksi">-</span>
                            </div>
                            <div class="result-item">
                                <span class="fw-bold">Diagnosis:</span>
                                <span id="diagnosis">-</span>
                            </div>
                            <div class="result-item">
                                <span class="fw-bold">Cara Mengatasi:</span>
                                <span id="caraMengatasi">-</span>
                            </div>
                        </div>

                        <button class="btn w-100 mt-3" id="openAIButton" style="background-color: #3F7A6F; color: white;">
                            AI Asisten
                        </button>

                        <!-- Tombol Kembali ke Upload -->
                        <button class="btn w-100 mt-3" id="backToUploadButton" style="background-color: #3F7A6F; color: white;">
                            Kembali ke Deteksi Baru
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Modal AI Asisten -->
        <div class="modal fade" id="aiModal" tabindex="-1" aria-labelledby="aiModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content chat-modal">
                    <div class="modal-header chat-header">
                        <h5 class="modal-title" id="aiModalLabel">AI Asisten</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body chat-body">
                        <div class="chat-messages" id="chat-messages"></div> <!-- ID Diperbaiki -->
                    </div>
                    <div class="modal-footer chat-footer">
                        <input type="text" id="chat-input" class="form-control chat-input" placeholder="Ketik pesan..." onkeypress="handleKeyPress(event)">
                        <button class="btn btn-success chat-send" id="sendButton">Kirim</button> <!-- ID Ditambahkan -->
                    </div>
                </div>
            </div>
        </div>
        

        <!-- Modal Notifikasi -->
        <div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">Notifikasi</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalMessage">
                        <!-- Pesan akan diisi melalui JavaScript -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
